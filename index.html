<!doctype html>

<html lang="en">
<head>

  <meta charset="utf-8">

  <title>The HTML5 Herald</title>
  <meta name="description" content="Train Time Site Choo. Choo!">
  <meta name="Kenichiwa" content="SitePoint">

	<!-- jQuery CDN by Google -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

	<!-- Bootstrap Component -->
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Bootstrap Component -->
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	
	<!--[if lt IE 9]>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
	<![endif]-->

	<!-- Link to Stylesheet -->
  	<link rel="stylesheet" href="assets/css/style.css">	

</head>
<body>



<!-- 	Jumbotron Container  -->
	<div class="jumbotron">
	  <h1>Anytime is Train Time</h1>
	  <p>Choo Choo. A Comprehensive Directory of Train Times</p>
	  <p id="currentDateAndTime">Current Time: </p>
	</div>

<!-- Main container for bootstrap -->
<div class="container">
<!--  Generated Table -->
    <div class="row">
		<div class="col-lg-12">

			<div class="panel panel-info">
				<div class="panel-heading">
					<h3 class="panel-title">Current Train Schedule</h3>
				</div>

				<div class="panel-body">
						<table class="table table-hover">
							  <thead>
								    <tr>
								      <th>Train Name</th>
								      <th>Destination</th>
								      <th>Frequency (min)</th>
								      <th>Next Arrival</th>
								      <th>Minutes Away</th>
								    </tr>
							  </thead>

							  <tbody class="trainInformation">
								    <tr>
								      <td>Trenton Express</td>
								      <td>Trenton</td>
								      <td>25</td>
								      <td>05:35 PM</td>
								      <td>10</td>
								    </tr>
							  </tbody>
						</table>
				</div>
			</div>
		</div>	
	</div> <!-- <div class="row"> -->


	<!-- Form Section -->
	<div class="row">
		<div class="col-lg-12">
			<div class="panel panel-info">
				<div class="panel-heading">
					<h3 class="panel-title">Add Train</h3>
				</div>
				<div class="panel-body">
					<form>
						<div class="form-group"> <!-- Input for Train Names  -->
							<label for="traineName">Train Name</label>
							<input type="text" class="form-control" id="trainName">
						</div>
						<div class="form-group"> <!-- Input for Destinations -->
							<label for="destination">Destination</label>
							<input type="text" class="form-control" id="destination">
						</div>	
						<div class="form-group"> <!-- First Train Time  -->
							<label for="firstTrainTime">First Train Time (00:00 - military time)</label>
							<input type="text" class="form-control" id="firstTrainTime">
						</div>	
						<div class="form-group"> <!-- Frequency of Train Arrivals -->
							<label for="frequency">Frequency (min)</label>
							<input type="text" class="form-control" id="frequency">
						</div>	
						<button id="submit" type="submit" class="btn btn-info">Submit</button>
					</form>

				</div>
			</div>
		</div>	
	</div> <!-- <div class="row"> -->

</div> <!--  <div class="container"> -->

	<!-- Latest compiled and minified CSS & JS -->
	<script src="https://code.jquery.com/jquery.js"></script>

	<!-- Link to JavaScript File -->
<!-- 	<script src="assets/js/javascript.js"></script> -->

	<!-- Link to firebase data  -->
	<script src="https://www.gstatic.com/firebasejs/3.5.3/firebase.js"></script>

	<!-- Added Moment JS -->
 	<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

<script>

// GLOBAL VARIABLES // Arrays and variables for holding data
// =================================================================

  // Initialize Firebase
	var config = {
		apiKey: "AIzaSyBtQ0s6D2BqAntMzT_bZlhV82wm6SxVZBA",
		authDomain: "train-time-73250.firebaseapp.com",
		databaseURL: "https://train-time-73250.firebaseio.com",
		storageBucket: "train-time-73250.appspot.com",
		messagingSenderId: "358539235836"
	};
	firebase.initializeApp(config);

	var database = firebase.database();

	// Create variables for form inputs. 
	var trainName = "";
	var destination = "";
	var firstTrainTime = "";
	var frequency = "";
	
// FUNCTIONS (Reusable blocks of code that I will call upon when needed)
// =================================================================

	var currentDateAndTime = Date();
	// Display current Date and Time 
	$('#currentDateAndTime').append(currentDateAndTime);
	console.log('1 current Time: '+ currentDateAndTime);
	// Convert time to a String 
	var currentDateAndTimeInString = currentDateAndTime.toString().split(" ");
	// Variable of Current Time 
	var currentTime = currentDateAndTimeInString[4]
	console.log('2 '+ currentTime);


// MAIN PROCESS
// =================================================================

	$('#submit').on('click', function(){

			// grab text from input field, grab value & trim blank spaces before and after 
		  	trainName = $('#trainName').val().trim();
		  	destination = $('#destination').val().trim();
		  	firstTrainTime = $('#firstTrainTime').val().trim();
		  	frequency = $('#frequency').val().trim();

// Moment ============================================================

		  	// First Time (pushed back 1 year to make sure it comes before current time)
		  	var firstTimeConverted = moment(firstTrainTime,"hh:mm").subtract(1, "years");
		  	console.log(firstTimeConverted);

		  	// Current Time
		  	var currentTimeMoment = moment();
		  	console.log("Current Time: " + moment(currentTimeMoment).format("hh:mm"));

		  	//Difference between the times
		  	var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
		  	console.log("Difference In Time: " + diffTime);

		  	// Time apart (remainder)
		  	var tRemainder = diffTime % frequency;
		  	console.log(tRemainder);

		  	// Minute Until Train
		  	var tMinutesUntilTrain = frequency - tRemainder;
		  	console.log("Minutes Until Train: " + tMinutesUntilTrain);

		  	// Next Train
		  	var nextTrain = moment().add(tMinutesUntilTrain, "minutes");
		  	console.log("Arrival Time: " + moment(nextTrain).format("hh:mm"));

		  	// Next Train Arrival Time
		  	 nextTrainArrivalTime = moment(nextTrain).format("hh:mm");


// End Moment ============================================================
			// debugger;
		  	// pushing object data to firebase
		  	database.ref().push({
		  		// timeStamp: firebase.database.ServerValue.TIMESTAMP,
		  		train: trainName,
		  		destination : destination,
		  		trainTime: firstTrainTime,
				frequency: frequency,
				nextArrival: nextTrainArrivalTime,
				minutesAway: tMinutesUntilTrain
		  	});

	// Don't refresh the page!
	return false; 
	}); // End #submit click function


	// Create Firebase "watcher" (.on("value"))
	database.ref().on('child_added', function(snapshot){
		// Log everthing that's coming out of snapshot
		console.log(snapshot.val());
		console.log('train: '+ snapshot.val().train);
		console.log('destination: '+ snapshot.val().destination);
		console.log('train time: '+ snapshot.val().trainTime);
		console.log('frequency: '+ snapshot.val().frequency);
		console.log('next train: '+ snapshot.val().nextArrival);
		console.log('minutes away: '+ snapshot.val().minutesAway);

		$(".trainInformation").append('<tr><td>'+ snapshot.val().train +'</td><td>'+ snapshot.val().destination +'</td><td>'+ snapshot.val().frequency +'</td><td>'+ snapshot.val().nextArrival +'</td><td>'+ snapshot.val().minutesAway +'</td></tr>');

	}); // End database.ref().on('value', function(snapshot){




</script>

</body>
</html>